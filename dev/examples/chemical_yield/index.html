<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Chemical Yield Optimization · laGP.jl</title><meta name="title" content="Chemical Yield Optimization · laGP.jl"/><meta property="og:title" content="Chemical Yield Optimization · laGP.jl"/><meta property="twitter:title" content="Chemical Yield Optimization · laGP.jl"/><meta name="description" content="Documentation for laGP.jl."/><meta property="og:description" content="Documentation for laGP.jl."/><meta property="twitter:description" content="Documentation for laGP.jl."/><meta property="og:url" content="https://joshualeond.github.io/laGP.jl/stable/examples/chemical_yield/"/><meta property="twitter:url" content="https://joshualeond.github.io/laGP.jl/stable/examples/chemical_yield/"/><link rel="canonical" href="https://joshualeond.github.io/laGP.jl/stable/examples/chemical_yield/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">laGP.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../theory/">Theory</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../demo/">Local Approximate GP Demo</a></li><li><a class="tocitem" href="../motorcycle/">Motorcycle Crash Test</a></li><li><a class="tocitem" href="../sinusoidal/">Posterior Sampling</a></li><li><a class="tocitem" href="../multivariate/">Multivariate Inputs (ARD)</a></li><li><a class="tocitem" href="../surrogates/">Wing Weight Surrogate</a></li><li><a class="tocitem" href="../satellite/">Satellite Drag Modeling</a></li><li><a class="tocitem" href="../bayesian_optimization/">Bayesian Optimization</a></li><li class="is-active"><a class="tocitem" href>Chemical Yield Optimization</a><ul class="internal"><li><a class="tocitem" href="#The-Manufacturing-Problem"><span>The Manufacturing Problem</span></a></li><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Yield-Function"><span>Yield Function</span></a></li><li><a class="tocitem" href="#Expected-Improvement"><span>Expected Improvement</span></a></li><li><a class="tocitem" href="#Initial-Design"><span>Initial Design</span></a></li><li><a class="tocitem" href="#Initial-GP-Surrogate"><span>Initial GP Surrogate</span></a></li><li><a class="tocitem" href="#Bayesian-Optimization"><span>Bayesian Optimization</span></a></li><li><a class="tocitem" href="#Final-Surrogate"><span>Final Surrogate</span></a></li><li><a class="tocitem" href="#Convergence"><span>Convergence</span></a></li><li><a class="tocitem" href="#ARD-Lengthscale-Interpretation"><span>ARD Lengthscale Interpretation</span></a></li><li><a class="tocitem" href="#Running-the-Example"><span>Running the Example</span></a></li><li><a class="tocitem" href="#Extensions"><span>Extensions</span></a></li><li><a class="tocitem" href="#See-Also"><span>See Also</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Chemical Yield Optimization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Chemical Yield Optimization</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/joshualeond/laGP.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/joshualeond/laGP.jl/blob/main/docs/src/examples/chemical_yield.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Chemical-Yield-Optimization"><a class="docs-heading-anchor" href="#Chemical-Yield-Optimization">Chemical Yield Optimization</a><a id="Chemical-Yield-Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Chemical-Yield-Optimization" title="Permalink"></a></h1><p>This example demonstrates modern Response Surface Methodology (RSM) using a GP surrogate with Expected Improvement-based Bayesian Optimization, inspired by the pioneering work of George Box and K.B. Wilson (1951) on optimizing chemical manufacturing processes.</p><h2 id="The-Manufacturing-Problem"><a class="docs-heading-anchor" href="#The-Manufacturing-Problem">The Manufacturing Problem</a><a id="The-Manufacturing-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#The-Manufacturing-Problem" title="Permalink"></a></h2><p>In chemical manufacturing, each experiment is expensive — requiring raw materials, reactor time, and lab analysis. The goal is to find operating conditions (temperature, pressure, catalyst loading, etc.) that maximize product yield using as few experiments as possible.</p><p>Classical RSM fits low-order polynomials to designed experiments. Here we replace the polynomial with a <strong>separable GP surrogate</strong> that:</p><ul><li>Captures nonlinear response surfaces without pre-specifying a model form</li><li>Provides uncertainty estimates that guide where to experiment next</li><li>Learns per-dimension sensitivity via ARD (Automatic Relevance Determination)</li></ul><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><pre><code class="language-julia hljs">using laGP
using CairoMakie
using Random
using Distributions: Normal, cdf, pdf
using LatinHypercubeSampling

Random.seed!(42)</code></pre><h2 id="Yield-Function"><a class="docs-heading-anchor" href="#Yield-Function">Yield Function</a><a id="Yield-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Yield-Function" title="Permalink"></a></h2><p>We define a synthetic 2D yield surface over Temperature (150-300 °C) and Pressure (1-10 atm) with three optima — a challenging multi-modal landscape:</p><pre><code class="language-julia hljs">function chemical_yield(T, P)
    t = (T - 150) / 150   # normalize to [0, 1]
    p = (P - 1) / 9

    # Global optimum: ~96% at T≈232, P≈6.5
    global_peak = 45.0 * exp(-25.0 * (t - 0.533)^2 - 8.0 * (p - 0.611)^2)

    # Local optimum 1: ~74% at T≈175, P≈2.8
    local1 = 26.0 * exp(-20.0 * (t - 0.167)^2 - 15.0 * (p - 0.20)^2)

    # Local optimum 2: ~73% at T≈275, P≈8.5
    local2 = 22.0 * exp(-18.0 * (t - 0.833)^2 - 12.0 * (p - 0.833)^2)

    return 48.0 + global_peak + local1 + local2
end</code></pre><p>The global peak is narrow and anisotropic (temperature ~3× more sensitive than pressure), making it a good test for separable GPs.</p><h3 id="True-Surface"><a class="docs-heading-anchor" href="#True-Surface">True Surface</a><a id="True-Surface-1"></a><a class="docs-heading-anchor-permalink" href="#True-Surface" title="Permalink"></a></h3><p><img src="../../assets/chem_true_surface.png" alt="True yield surface"/></p><p>The 3D view (left) reveals the multi-modal landscape. The contour plot (right) shows the global optimum near T≈232 °C, P≈6.5 atm, flanked by two weaker local optima.</p><h2 id="Expected-Improvement"><a class="docs-heading-anchor" href="#Expected-Improvement">Expected Improvement</a><a id="Expected-Improvement-1"></a><a class="docs-heading-anchor-permalink" href="#Expected-Improvement" title="Permalink"></a></h2><p>We implement the <strong>Expected Improvement</strong> (EI) acquisition function for maximization:</p><p class="math-container">\[\text{EI}(x) = (\mu(x) - f_{\text{best}}) \, \Phi(z) + \sigma(x) \, \phi(z), \quad z = \frac{\mu(x) - f_{\text{best}}}{\sigma(x)}\]</p><p>where <span>$\mu(x)$</span> and <span>$\sigma(x)$</span> are the GP posterior mean and standard deviation, <span>$f_{\text{best}}$</span> is the best observation so far, and <span>$\Phi$</span>, <span>$\phi$</span> are the standard normal CDF and PDF.</p><pre><code class="language-julia hljs">function expected_improvement(mu, sigma, f_best)
    ei = zeros(length(mu))
    for i in eachindex(mu)
        if sigma[i] &gt; 1e-10
            z = (mu[i] - f_best) / sigma[i]
            ei[i] = (mu[i] - f_best) * cdf(Normal(), z) + sigma[i] * pdf(Normal(), z)
        end
    end
    return ei
end</code></pre><p>EI naturally balances <strong>exploitation</strong> (high predicted yield) with <strong>exploration</strong> (high uncertainty), preferring points that have the greatest expected improvement over the current best.</p><h2 id="Initial-Design"><a class="docs-heading-anchor" href="#Initial-Design">Initial Design</a><a id="Initial-Design-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-Design" title="Permalink"></a></h2><p>We start with a Latin Hypercube Sample of 8 points — a space-filling design that ensures good coverage of the input space:</p><pre><code class="language-julia hljs">n_init = 8
plan, _ = LHCoptim(n_init, 2, 100)
X_coded = scaleLHC(plan, [(0.0, 1.0), (0.0, 1.0)])
Y_obs = [yield_coded(X_coded[i, 1], X_coded[i, 2]) for i in 1:n_init]</code></pre><p><img src="../../assets/chem_initial_design.png" alt="Initial LHS design"/></p><p>The 8 initial points (white circles) are spread across the input space. The best initial observation is <strong>77.4%</strong> — near a local optimum, far from the global peak of ~96%.</p><h2 id="Initial-GP-Surrogate"><a class="docs-heading-anchor" href="#Initial-GP-Surrogate">Initial GP Surrogate</a><a id="Initial-GP-Surrogate-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-GP-Surrogate" title="Permalink"></a></h2><p>We fit a <strong>separable GP</strong> to the initial data using <code>new_gp_sep</code> and optimize hyperparameters via <code>jmle_gp_sep!</code>:</p><pre><code class="language-julia hljs">d_info = darg_sep(X_coded)
g_info = garg(Y_obs)

d_init = [d_info.ranges[1].start, d_info.ranges[2].start]
gp = new_gp_sep(X_coded, Y_obs, d_init, g_info.start)

drange = (d_info.ranges[1].min, d_info.ranges[1].max)
grange = (g_info.min, g_info.max)
jmle_gp_sep!(gp; drange=drange, grange=grange, verb=0)</code></pre><p><img src="../../assets/chem_initial_surrogate.png" alt="Initial GP surrogate"/></p><p>With only 8 observations, the GP captures the general trend but has high uncertainty (right panel) in unexplored regions.</p><h2 id="Bayesian-Optimization"><a class="docs-heading-anchor" href="#Bayesian-Optimization">Bayesian Optimization</a><a id="Bayesian-Optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Bayesian-Optimization" title="Permalink"></a></h2><p>At each iteration, we:</p><ol><li>Rebuild the separable GP on all data collected so far</li><li>Predict on an 80×80 grid covering the input space</li><li>Compute EI at each grid point</li><li>Evaluate the yield at the EI-maximizing location</li></ol><pre><code class="language-julia hljs">for iter in 1:15
    # Rebuild GP
    gp_i = new_gp_sep(X_bo, Y_bo, d_init_i, g_info_i.start)
    jmle_gp_sep!(gp_i; drange=drange_i, grange=grange_i, verb=0)

    # Predict and compute EI
    pred_i = pred_gp_sep(gp_i, XX; lite=true)
    ei_i = expected_improvement(pred_i.mean, sqrt.(pred_i.s2), maximum(Y_bo))

    # Next experiment at EI maximum
    x_next = XX[argmax(ei_i), :]
    y_next = yield_coded(x_next[1], x_next[2])

    X_bo = vcat(X_bo, x_next&#39;)
    Y_bo = vcat(Y_bo, y_next)
end</code></pre><h3 id="Iteration-1:-Discovery"><a class="docs-heading-anchor" href="#Iteration-1:-Discovery">Iteration 1: Discovery</a><a id="Iteration-1:-Discovery-1"></a><a class="docs-heading-anchor-permalink" href="#Iteration-1:-Discovery" title="Permalink"></a></h3><p>The first BO iteration jumps from 77.4% to <strong>94.3%</strong> — EI directs the search straight to the global optimum region.</p><p><img src="../../assets/chem_bo_iter_1.png" alt="BO iteration 1"/></p><p>Left: GP mean prediction with the next evaluation point (red star). Right: EI heatmap showing where the algorithm expects the greatest improvement.</p><h3 id="Iteration-5:-Refinement"><a class="docs-heading-anchor" href="#Iteration-5:-Refinement">Iteration 5: Refinement</a><a id="Iteration-5:-Refinement-1"></a><a class="docs-heading-anchor-permalink" href="#Iteration-5:-Refinement" title="Permalink"></a></h3><p>By iteration 5, the GP has refined its estimate of the global peak. Best yield: <strong>95.2%</strong>.</p><p><img src="../../assets/chem_bo_iter_5.png" alt="BO iteration 5"/></p><h3 id="Iteration-10:-Exploitation"><a class="docs-heading-anchor" href="#Iteration-10:-Exploitation">Iteration 10: Exploitation</a><a id="Iteration-10:-Exploitation-1"></a><a class="docs-heading-anchor-permalink" href="#Iteration-10:-Exploitation" title="Permalink"></a></h3><p>With 18 total observations, the GP accurately models the global optimum region. EI is now concentrated on fine-tuning.</p><p><img src="../../assets/chem_bo_iter_10.png" alt="BO iteration 10"/></p><h3 id="Iteration-15:-Convergence"><a class="docs-heading-anchor" href="#Iteration-15:-Convergence">Iteration 15: Convergence</a><a id="Iteration-15:-Convergence-1"></a><a class="docs-heading-anchor-permalink" href="#Iteration-15:-Convergence" title="Permalink"></a></h3><p>Final best yield: <strong>95.2%</strong>, within 0.6% of the true optimum (95.8%).</p><p><img src="../../assets/chem_bo_iter_15.png" alt="BO iteration 15"/></p><h2 id="Final-Surrogate"><a class="docs-heading-anchor" href="#Final-Surrogate">Final Surrogate</a><a id="Final-Surrogate-1"></a><a class="docs-heading-anchor-permalink" href="#Final-Surrogate" title="Permalink"></a></h2><p>After all 23 experiments (8 initial + 15 BO), the GP accurately reconstructs the entire yield surface:</p><p><img src="../../assets/chem_final_surrogate.png" alt="Final surrogate comparison"/></p><p>The three panels show: true yield surface (left), GP mean prediction with all observation locations (center), and GP uncertainty (right). Uncertainty is lowest near the global optimum where observations are concentrated.</p><h2 id="Convergence"><a class="docs-heading-anchor" href="#Convergence">Convergence</a><a id="Convergence-1"></a><a class="docs-heading-anchor-permalink" href="#Convergence" title="Permalink"></a></h2><p><img src="../../assets/chem_convergence.png" alt="Convergence plot"/></p><p>BO finds near-optimal conditions in just <strong>23 experiments</strong> — compared to 100 for a naive 10×10 grid search. That&#39;s a <strong>~4× reduction</strong> in experimental cost.</p><h2 id="ARD-Lengthscale-Interpretation"><a class="docs-heading-anchor" href="#ARD-Lengthscale-Interpretation">ARD Lengthscale Interpretation</a><a id="ARD-Lengthscale-Interpretation-1"></a><a class="docs-heading-anchor-permalink" href="#ARD-Lengthscale-Interpretation" title="Permalink"></a></h2><p>The separable GP&#39;s per-dimension lengthscales reveal process sensitivity:</p><pre><code class="nohighlight hljs">Final separable GP lengthscales:
  d[1] (Temperature) = 0.079
  d[2] (Pressure)    = 0.657
  Ratio d[2]/d[1]    = 8.3</code></pre><p>A smaller lengthscale means the function varies more rapidly in that direction. Temperature&#39;s lengthscale is <strong>~8× smaller</strong> than Pressure&#39;s, confirming that yield is much more sensitive to temperature changes — a valuable insight for process control.</p><h2 id="Running-the-Example"><a class="docs-heading-anchor" href="#Running-the-Example">Running the Example</a><a id="Running-the-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Example" title="Permalink"></a></h2><pre><code class="language-bash hljs">julia --project=examples examples/chemical_yield_rsm.jl</code></pre><p>This generates 9 PNG files in the <code>examples/</code> directory.</p><h2 id="Extensions"><a class="docs-heading-anchor" href="#Extensions">Extensions</a><a id="Extensions-1"></a><a class="docs-heading-anchor-permalink" href="#Extensions" title="Permalink"></a></h2><ul><li><strong>Noisy observations</strong>: Increase the nugget or optimize it via <code>jmle_gp_sep!()</code> to handle measurement noise</li><li><strong>Higher dimensions</strong>: Add catalyst type, flow rate, etc. — ARD automatically identifies which matter</li><li><strong>Batch BO</strong>: Select multiple points per iteration for parallel experiments</li><li><strong>Constraints</strong>: Incorporate safety constraints (e.g., max pressure, min yield threshold)</li></ul><h2 id="See-Also"><a class="docs-heading-anchor" href="#See-Also">See Also</a><a id="See-Also-1"></a><a class="docs-heading-anchor-permalink" href="#See-Also" title="Permalink"></a></h2><ul><li><a href="../bayesian_optimization/">Bayesian Optimization</a> — 1D BO example with UCB acquisition</li><li><a href="../multivariate/">Multivariate Inputs (ARD)</a> — Isotropic vs separable GP comparison</li><li>Box, G.E.P. and Wilson, K.B. (1951). &quot;On the Experimental Attainment of Optimum Conditions.&quot; <em>Journal of the Royal Statistical Society B</em>, 13(1), 1–45.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../bayesian_optimization/">« Bayesian Optimization</a><a class="docs-footer-nextpage" href="../../api/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 6 February 2026 21:08">Friday 6 February 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
